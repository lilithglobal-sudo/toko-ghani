<script>
if (!sessionStorage.getItem("admin")) {
  window.location.href = "login.html";
}
</script>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Admin Panel - Toko Ghani</title>

<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body {
  font-family: Arial;
  background: #f2f2f2;
  padding: 20px;
}
.box {
  max-width: 420px;
  margin: auto;
  background: white;
  padding: 20px;
  border-radius: 8px;
}
input, button {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
}
button {
  background: #2ecc71;
  border: none;
  color: white;
  font-weight: bold;
  cursor: pointer;
}
button:hover {
  background: #27ae60;
}
.product {
  background: #eee;
  padding: 10px;
  margin-top: 10px;
  border-radius: 5px;
}
img {
  width: 100%;
  margin-top: 5px;
  border-radius: 5px;
}
.delete {
  background: #e74c3c;
  margin-top: 5px;
}
</style>
</head>
<body>

<div class="box">
  <h2>üîê Admin - Toko Ghani</h2>

  <input id="name" placeholder="Nama Produk">
  <input id="price" type="number" placeholder="Harga">
  <input id="stock" type="number" placeholder="Stok">
  <input id="image" type="file" accept="image/*">

  <button id="btnAdd">Tambah Produk</button>

  <div id="list"></div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyARkm1CBiNsXUS6DgmQGnK9GvRZhTiwKOM",
  authDomain: "toko-ghani-f2f67.firebaseapp.com",
  databaseURL: "https://toko-ghani-f2f67-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "toko-ghani-f2f67",
  storageBucket: "toko-ghani-f2f67.appspot.com",
  messagingSenderId: "177481860025",
  appId: "1:177481860025:web:ed62358c58cc309ade2c68"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

document.getElementById("btnAdd").addEventListener("click", addProduct);

function addProduct() {
  const name = document.getElementById("name").value.trim();
  const price = document.getElementById("price").value;
  const stock = document.getElementById("stock").value;
  const file = document.getElementById("image").files[0];

  if (!name || !price || !stock || !file) {
    alert("Lengkapi semua data dan upload foto!");
    return;
  }

  const reader = new FileReader();
  reader.onload = function() {
    const newRef = db.ref("products").push();
    newRef.set({
      name: name,
      price: price,
      stock: stock,
      image: reader.result,
      time: Date.now()
    }).then(() => {
      alert("Produk berhasil ditambahkan!");
    }).catch(err => {
      alert("Gagal upload: " + err.message);
      console.error(err);
    });

    document.getElementById("name").value = "";
    document.getElementById("price").value = "";
    document.getElementById("stock").value = "";
    document.getElementById("image").value = "";
  };
  reader.readAsDataURL(file);
}

function deleteProduct(id) {
  if (confirm("Hapus produk ini?")) {
    db.ref("products/" + id).remove();
  }
}

db.ref("products").on("value", snapshot => {
  const list = document.getElementById("list");
  list.innerHTML = "";

  snapshot.forEach(child => {
    const p = child.val();
    const div = document.createElement("div");
    div.className = "product";
    div.innerHTML = `
      <b>${p.name}</b><br>
      Rp ${p.price}<br>
      Stok: ${p.stock}<br>
      <img src="${p.image}">
      <button class="delete" onclick="deleteProduct('${child.key}')">Hapus</button>
    `;
    list.appendChild(div);
  });
});
</script>

</body>
</html>

